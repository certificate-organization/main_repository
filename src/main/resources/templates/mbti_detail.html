<html lang="ko" layout:decorate="~{layout}">
<head>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
    <title>MBTI 게시판</title>
</head>

<body>
<div layout:fragment="content" class="article-container">
    <!-- 게시판 상단 start -->
    <div class="col-6">
        <div class="wrap">
            <div class="dark_mode">
                <div class="inner">
                    <input type="radio" name="toggle" id="toggle_light" checked><label for="toggle_light" class="light_icon"><i class="fas fa-sun light_icon"></i></label>
                    <input type="radio" name="toggle" id="toggle_dark"><label for="toggle_dark" class="dark_icon"><i class="fas fa-moon dark_icon"></i></label>
                    <div class="dark_mode-bg"></div>
                </div>
            </div>
        </div>
        <div class="TOP">
            <div class="logo">
                <a class="article-logo" th:href="@{|/mbti/${mbti.id}|}" th:text="|${mbti.name} 게시판|"></a>
            </div>
            <a th:if="${member != null and member.mbti.id == mbti.id}"
               sec:authorize="isAuthenticated()"
               th:href="@{|/mbti/${mbti.id}/article/create|}" class="create-btn">글쓰기</a>
        </div>
    </div>
    <!-- 게시판 상단 end -->
    <!-- mbti 정보 start -->
    <div class="mbti-information">
        <div class="mbti-elements">
            <div class="mbti-element" th:each="element : ${mbti.elements}">
                <span class="mbti-element-text" th:text="${element}"></span>
            </div>
        </div>
        <!-- tab메뉴 start -->
        <div class="tab-container">
            <div class="d-flex align-items-start">
                <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
                    <button class="nav-link active" id="v-pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home"
                            aria-selected="true">연애
                    </button>
                    <button class="nav-link" id="v-pills-profile-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-profile" type="button" role="tab" aria-controls="v-pills-profile"
                            aria-selected="false">관계
                    </button>
                    <button class="nav-link" id="v-pills-disabled-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-disabled" type="button" role="tab" aria-controls="v-pills-disabled"
                            aria-selected="false">유명인
                    </button>
                    <button class="nav-link" id="v-pills-messages-tab" data-bs-toggle="pill"
                            data-bs-target="#v-pills-messages" type="button" role="tab" aria-controls="v-pills-messages"
                            aria-selected="false">직업
                    </button>
                </div>
                <div class="tab-content" id="v-pills-tabContent">
                    <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel"
                         aria-labelledby="v-pills-home-tab" tabindex="0" th:text="${mbti.love}">
                    </div>
                    <div class="tab-pane fade" id="v-pills-profile" role="tabpanel"
                         aria-labelledby="v-pills-profile-tab" tabindex="0" th:text="${mbti.relationship}">
                    </div>
                    <div class="tab-pane fade" id="v-pills-disabled" role="tabpanel"
                         aria-labelledby="v-pills-disabled-tab" tabindex="0" th:text="${mbti.celebrity}">
                    </div>
                    <div class="tab-pane fade" id="v-pills-messages" role="tabpanel"
                         aria-labelledby="v-pills-messages-tab" tabindex="0" th:text="${mbti.job}">
                    </div>
                </div>
            </div>
        </div>
        <!-- tab메뉴 end -->
    </div>
    <div class="information-btn">
        <a th:if="${member != null and #authentication.getPrincipal().getUsername() == 'admin'}"
           sec:authorize="isAuthenticated()"
           th:href="@{/mbti/information}" class="back-btn">수정</a>
    </div>
    <!-- mbti 정보 end -->
    <!-- 게시글 start -->
    <div class="article-table">
        <table class="article-list">
            <thead class="article-list-head">
            <tr>
                <th>번호</th>
                <th class="article-list-subject-head">제목</th>
                <th>작성자</th>
                <th>작성일</th>
                <th>조회수</th>
                <th>추천수</th>
            </tr>
            </thead>
            <tbody>
            <tr class="article-list-body" th:each="article, loop : ${articlePage}">
                <th th:text="${articlePage.getTotalElements - (articlePage.number * articlePage.size) - loop.index}"></th>
                <td class="article-list-subject-body">
                    <a class="article-list-subject" th:href="@{|/article/${article.id}|}"
                       th:text="${article.subject}">
                    </a>
                    <span th:if="${#lists.size(article.commentList) != 0}"
                          class="article-comment" th:text="|[${#lists.size(article.commentList)}]|"></span>
                </td>
                <td>
                    <a class="article-list-author" href="#"
                       th:text="|${article.author.nickname}[${article.author.mbti.name}]|"></a>
                </td>
                <td style="width: 8%" th:id="|result${loop.index + 1}|"></td>
                <td style="width: 6%" th:text="${article.viewCount}"></td>
                <td style="width: 6%" th:text="${#lists.size(article.likers)}|"></td>
                <script th:src="@{/js/calculateDate.js}"></script>
                <script th:inline="javascript">
                    calculateDate (/*[[${article.createDate}]]*/, 'result' + /*[[${loop.index + 1}]]*/);
                </script>
            </tr>
            </tbody>
        </table>
    </div>
    <!-- 게시글 end -->
    <!-- 페이징 start -->
    <div th:if="${!articlePage.isEmpty()}">
        <ul class="article-paging">
            <li th:if="${articlePage.hasPrevious()}">
                <a class="article-page" th:href="@{|?keyword=${keyword}&page=${articlePage.number-1}|}"
                   aria-label="Previous">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li th:if="${page <= articlePage.number+10}"
                th:each="page: ${#numbers.sequence(0, articlePage.totalPages-1)}">
                <a class="article-page" th:classappend="${page == articlePage.number} ? 'active-page'"
                   th:href="@{|?keyword=${keyword}&page=${page}|}"
                   th:text="${page+1}"></a>
            </li>
            <li th:if="${articlePage.hasNext}">
                <a class="article-page" th:href="@{|?keyword=${keyword}&page=${articlePage.number+1}|}"
                   aria-label="Next">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        </ul>
    </div>
    <!-- 페이징 end -->
    <!-- 검색 start -->
    <div class="article-table" th:if="${!articlePage.isEmpty()}">
        <form th:action="@{|/mbti/${mbti.id}|}" method="get" class="search-box">
            <div class="search-box-inner">
                <input class="search-txt" type="text"
                       name="keyword" th:value="${keyword}" placeholder="검색어를 입력하세요.">
                <button class="search-btn" type="submit">
                    <i class="fa fa-search fa-magnifying-glass"></i>
                </button>
            </div>
        </form>
    </div>
    <!-- 검색 end -->
    <!-- 검색기능 start -->
    <form th:action="@{|/mbti/${mbti.id}|}" method="get">
        <input type="hidden" name="keyword" th:value="${keyword}">
        <input type="hidden" name="page" th:value="${articlePage.number}">
    </form>
    <!-- 검색기능 end -->
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0/dist/js/bootstrap.bundle.min.js"></script>
</html>